<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap");
    </style>
    <style>
      @import url("../styles/entrar.css");
    </style>

    <title>Página de Login</title>

    <script>
      (function () {
        const form = document.getElementById("loginForm");
        const submitBtn = document.getElementById("submitLoginBtn");
        const spinner = document.getElementById("spinner");
        const status = document.getElementById("status");

        // Helper: simulate network request (mock)
        function fakePost(formData) {
          return new Promise((resolve) => {
            // Simulate 900ms latency
            setTimeout(() => {
              // Return a fake success response
              resolve({ ok: true, redirect: "./projetos.html" });
            }, 900);
          });
        }

        form.addEventListener("submit", async function (e) {
          // Let native HTML5 check validity first
          if (!form.checkValidity()) {
            // If invalid, let browser display validation UI
            return;
          }

          e.preventDefault(); // take control (progressive enhancement)

          // Disable UI
          submitBtn.disabled = true;
          spinner.classList.remove("hidden");
          status.textContent = "Entrando...";

          // Collect data using FormData (works with files too)
          const fd = new FormData(form);

          try {
            // Use fakePost to mock server. Replace with fetch() for real submission.
            const res = await fakePost(fd);

            if (res.ok) {
              status.textContent = "Você está dentro! Redirecionando…";

              // Navigate to success page. Use location.replace so Back won't resubmit
              // If you want SPA-style replaceState instead, see comment below.
              window.location.replace(res.redirect || "./projetos.html");
            } else {
              // handle server-side errors
              status.textContent =
                "Algo deu errado. Tente novamente mais tarde.";
              submitBtn.disabled = false;
              spinner.classList.add("hidden");
            }
          } catch (err) {
            status.textContent =
              "Erro de conexão — por favor teste sua conexão.";
            submitBtn.disabled = false;
            spinner.classList.add("hidden");
          }
        });
      })();
    </script>
  </head>
  <body>
    <div class="login">
      <div class="login__header">
        <div class="login__icon">
          <i class="fas fa-building"></i>
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
            <rect width="24" height="24" rx="6" fill="#2561E8" />
            <path
              d="M12 17s-5-3.33-5-7a3 3 0 0 1 6 0 3 3 0 0 1 6 0c0 3.67-5 7-5 7Z"
              fill="white"
            />
          </svg>
        </div>
        <h1 class="login__title">Bem vindo de Volta</h1>
        <p class="login__subtitle">Entre na sua conta</p>
      </div>

      <form
        class="login__form"
        id="loginForm"
        action="./projetos.html"
        method="post"
      >
        <div class="login__field">
          <label class="login__label" for="institution">Instituição</label>
          <div class="login__input-wrapper">
            <i class="login__input-icon fas fa-building"></i>
            <input
              class="login__input"
              type="text"
              id="institution"
              name="institution"
              placeholder="Entre a sua instituição"
              required
              minlength="2"
            />
          </div>
        </div>

        <div class="login__field">
          <label class="login__label" for="email">Email</label>
          <div class="login__input-wrapper">
            <i class="login__input-icon fas fa-envelope"></i>
            <input
              class="login__input"
              type="email"
              id="email"
              name="email"
              placeholder="Entre seu email"
              pattern="^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$"
              required
            />
          </div>
        </div>

        <div class="login__field">
          <label class="login__label" for="password">Senha</label>
          <div class="login__input-wrapper">
            <i class="login__input-icon fas fa-lock"></i>
            <input
              class="login__input"
              type="password"
              id="password"
              name="password"
              placeholder="Entre sua senha"
              required
              minlength="5"
            />
            <button
              type="button"
              class="login__toggle-password"
              aria-label="Toggle password visibility"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>

        <button class="login__button" id="submitLoginBtn" type="submit">
          Sign In
          <span class="login__spinner" id="spinner" aria-hidden="true"></span>
        </button>
      </form>

      <div class="login__footer">
        <a href="#" class="login__link">Esqueceu a senha?</a>
        <p class="login__signup">
          Ainda não tem conta?
          <a href="#" class="login__signup-link">Cadastrar</a>
        </p>
      </div>

      <div
        class="login__message"
        id="status"
        role="status"
        aria-live="polite"
      ></div>
    </div>
  </body>
</html>
